query SubaccountEventHistoryQuery(
  $subaccountEntityId: String!
  $maxTimeExclusive: BigInt!
  $minTimeInclusive: BigInt!
  # This enables hacky filtering of events
  $modifyCollateralLimit: Int
  $settlePnlLimit: Int
  $liquidateeLimit: Int
  $reportOrderLimit: Int
  $cancelOrderLimit: Int
) {
  modifyCollateralEvents(
    where: {
      subaccount: $subaccountEntityId
      blockTime_lt: $maxTimeExclusive
      blockTime_gt: $minTimeInclusive
    }
    orderBy: blockTime
    orderDirection: desc
    first: $modifyCollateralLimit
  ) {
    id
    blockTime

    amount
    productId
  }
  settlePnlEvents(
    where: {
      subaccount: $subaccountEntityId
      blockTime_lt: $maxTimeExclusive
      blockTime_gt: $minTimeInclusive
    }
    orderBy: blockTime
    orderDirection: desc
    first: $settlePnlLimit
  ) {
    id
    blockTime

    amount
    productId
  }
  liquidationEvents(
    where: {
      liquidatee: $subaccountEntityId
      blockTime_lt: $maxTimeExclusive
      blockTime_gt: $minTimeInclusive
    }
    orderBy: blockTime
    orderDirection: desc
    first: $liquidateeLimit
  ) {
    id
    blockTime

    productId
    liquidatorBaseDelta
    liquidatorQuoteDelta
    insuranceCoverage
  }
  reportOrderEvents(
    where: {
      subaccount: $subaccountEntityId
      blockTime_lt: $maxTimeExclusive
      blockTime_gt: $minTimeInclusive
    }
    orderBy: blockTime
    orderDirection: desc
    first: $reportOrderLimit
  ) {
    id
    blockTime

    # TODO: more fields
  }
  cancelOrderEvents(
    where: {
      subaccount: $subaccountEntityId
      blockTime_lt: $maxTimeExclusive
      blockTime_gt: $minTimeInclusive
    }
    orderBy: blockTime
    orderDirection: desc
    first: $cancelOrderLimit
  ) {
    id
    blockTime

    # TODO: more fields
  }
}

# Separate queries for taker/maker order fills, as we can't match an "OR" on the taker/maker fields
query SubaccountTakerFillEventHistoryQuery(
  $subaccountEntityId: String!
  $maxTimeExclusive: BigInt!
  $minTimeInclusive: BigInt!
  $limit: Int
) {
  fillOrderEvents(
    where: {
      taker: $subaccountEntityId
      blockTime_lt: $maxTimeExclusive
      blockTime_gt: $minTimeInclusive
    }
    orderBy: blockTime
    orderDirection: desc
    first: $limit
  ) {
    ...FillOrderEventFragment
  }
}
query SubaccountMakerFillEventHistoryQuery(
  $subaccountEntityId: String!
  $maxTimeExclusive: BigInt!
  $minTimeInclusive: BigInt!
  $limit: Int
) {
  fillOrderEvents(
    where: {
      maker: $subaccountEntityId
      blockTime_lt: $maxTimeExclusive
      blockTime_gt: $minTimeInclusive
    }
    orderBy: blockTime
    orderDirection: desc
    first: $limit
  ) {
    ...FillOrderEventFragment
  }
}

fragment FillOrderEventFragment on FillOrderEvent {
  id
  blockTime

  takerAmountDelta
  makerFee
  takerFee
  makerOrder {
    ...EventOrderFragment
  }
  takerOrder {
    ...EventOrderFragment
  }
}

# All fields on Order
fragment EventOrderFragment on Order {
  id
  digest
  validationResult
  priceX18
  subaccount {
    subaccountId
  }
  reportedAt
  reportedAtBlock
  filledAmount
  collectedFee
}
